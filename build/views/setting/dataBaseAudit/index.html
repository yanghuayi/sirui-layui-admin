<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="../../../../layui/css/layui-iframe.css">
  <link rel="stylesheet" href="../../../style/class.css">
  <link rel="stylesheet" href="../../../style/easyui.css">
  <link rel="stylesheet" href="../../../style/sirui.css">
  <link rel="stylesheet" href="../../../lib/extend/jquery.message.css">
  <title>数据库审计</title>
</head>
<body>
  <!-- 普通搜索 -->
  <form class="layui-form sirui-filter" lay-filter="filter-normal-group">
    <div class="layui-row layui-col-space20">
      <div class="layui-col-xs6 layui-col-lg2 layui-col-md3">
        <select name="leixing" palceholder="设备类型">
          <option value="">设备类型</option>
          <option value="3" selected>OTU</option>
          <option value="1">TCUA/B</option>
          <option value="2">TCUC</option>
        </select>
      </div>
      <div class="layui-col-xs6 layui-col-lg2 layui-col-md3">
        <select name="onOffline" palceholder="设备状态">
          <option value="">设备状态</option>
          <option value="1" selected>在线</option>
          <option value="0">离线</option>
        </select>
      </div>
      <div class="layui-col-xs6 layui-col-lg2 layui-col-md3">
        <input type="text" name="terminalID" placeholder="设备ID" autocomplete="off" class="layui-input">
      </div>
      <div class="layui-col-xs6 layui-col-lg2 layui-col-md3">
        <input type="text" name="IMEI" placeholder="IMEI" autocomplete="off" class="layui-input">
      </div>
      <div class="filter-btn-wrap layui-col-xs12 layui-col-sm12 layui-col-md6 layui-col-lg4">
        <button class="layui-btn" lay-submit="" lay-filter="search">
          <i class="layui-icon m-r-5">&#xe615;</i>查询
        </button>
        <button class="layui-btn" lay-submit="" lay-filter="reset">
          <i class="layui-icon m-r-5">&#x1002;</i>重置
        </button>
        <a class="sirui-more-link m-l-10" href="javascript:;">高级搜索
          <i class="layui-icon">&#xe61a;</i>
        </a>
        <button class="layui-btn add-btn" lay-submit="" lay-filter="add">
          <i class="layui-icon m-r-5">&#xe654;</i>新增
        </button>
      </div>
    </div>
  </form>
  <!-- 高级搜索 -->
  <form class="layui-form sirui-filter-all" lay-filter="filter-advanced-group">
    <div class="layui-row layui-col-space20">
      <div class="layui-col-xs6 layui-col-md4">
        <label class="layui-form-label">设备类型：</label>
        <div class="layui-input-block">
          <select name="leixing" palceholder="设备类型">
            <option value="">设备类型</option>
            <option value="3" selected>OTU</option>
            <option value="1">TCUA/B</option>
            <option value="2">TCUC</option>
          </select>
        </div>
      </div>
      <div class="layui-col-xs6 layui-col-md4">
        <label class="layui-form-label">设备状态：</label>
        <div class="layui-input-block">
          <select name="onOffline" palceholder="设备状态">
            <option value="">设备状态</option>
            <option value="1" selected>在线</option>
            <option value="0">离线</option>
          </select>
        </div>
      </div>
      <div class="layui-col-xs6 layui-col-md4">
        <label class="layui-form-label">terminalID：</label>
        <div class="layui-input-block">
          <input type="text" name="terminalID" placeholder="设备ID" autocomplete="off" class="layui-input">
        </div>
      </div>
      <div class="layui-col-xs6 layui-col-md4">
        <label class="layui-form-label">IMEI：</label>
        <div class="layui-input-block">
          <input type="text" name="IMEI" placeholder="IMEI" autocomplete="off" class="layui-input">
        </div>
      </div>
      <div class="layui-col-xs6 layui-col-md4">
        <label class="layui-form-label">barCode：</label>
        <div class="layui-input-block">
          <input type="text" name="barcode" placeholder="barCode" autocomplete="off" class="layui-input">
        </div>
      </div>
      <div class="layui-col-xs6 layui-col-md4">
        <label class="layui-form-label">软件名称：</label>
        <div class="layui-input-block">
          <input type="text" name="softwarename" placeholder="软件名称" autocomplete="off" class="layui-input">
        </div>
      </div>
      <div class="layui-col-xs6 layui-col-md4">
        <label class="layui-form-label">软件版本：</label>
        <div class="layui-input-block">
          <input type="text" name="softwareversion" placeholder="软件版本" autocomplete="off" class="layui-input">
        </div>
      </div>
      <div class="layui-col-xs6 layui-col-md4">
        <label class="layui-form-label">硬件版本：</label>
        <div class="layui-input-block">
          <input type="text" name="hardwareversion" placeholder="硬件版本" autocomplete="off" class="layui-input">
        </div>
      </div>
      <div class="filter-btn-wrap layui-col-xs12 layui-col-md12">
        <button class="layui-btn" lay-submit="" lay-filter="search">
          <i class="layui-icon m-r-5">&#xe615;</i>查询
        </button>
        <button class="layui-btn" lay-filter="reset">
          <i class="layui-icon m-r-5">&#x1002;</i>重置
        </button>
        <a class="sirui-normal-link m-l-10" href="javascript:;">普通搜索
          <i class="layui-icon">&#xe619;</i>
        </a>
      </div>
    </div>
  </form>
  <!-- 表格 -->
  <div class="sirui-table-wrap">
    <table id="sirui-table" class="sirui-table datagridTable" lay-filter="test">
        <div class="sirui-loading"></div>
    </table>
    <div id="table_laypage"></div>
  </div>
  <!-- 新增 -->
  <div id="addPage" style="display: none;">
    <form class="layui-form sirui-add-form" lay-filter="add-form-group">
      <div class="layui-row layui-col-space20">
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md4">
          <label class="layui-form-label">设备类型：</label>
          <div class="layui-input-block">
            <select name="leixing" lay-verify="required" palceholder="设备类型">
              <option value="">设备类型</option>
              <option value="3">OTU</option>
              <option value="1">TCUA/B</option>
              <option value="2">TCUC</option>
            </select>
          </div>
        </div>
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md4">
          <label class="layui-form-label">设备状态：</label>
          <div class="layui-input-block">
            <select name="onOffline" lay-verify="required" palceholder="设备状态">
              <option value="">设备状态</option>
              <option value="1">在线</option>
              <option value="0">离线</option>
            </select>
          </div>
        </div>
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md4">
          <label class="layui-form-label">terminalID：</label>
          <div class="layui-input-block">
            <input type="text" lay-verify="required" name="terminalID" placeholder="设备ID" autocomplete="off" class="layui-input">
          </div>
        </div>
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md4">
          <label class="layui-form-label">IMEI：</label>
          <div class="layui-input-block">
            <input type="text" lay-verify="required" name="IMEI" placeholder="IMEI" autocomplete="off" class="layui-input">
          </div>
        </div>
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md4">
          <label class="layui-form-label">barCode：</label>
          <div class="layui-input-block">
            <input type="text" lay-verify="required" name="barcode" placeholder="barCode" autocomplete="off" class="layui-input">
          </div>
        </div>
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md4">
          <label class="layui-form-label">软件名称：</label>
          <div class="layui-input-block">
            <input type="text" lay-verify="required" name="softwarename" placeholder="软件名称" autocomplete="off" class="layui-input">
          </div>
        </div>
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md4">
          <label class="layui-form-label">软件版本：</label>
          <div class="layui-input-block">
            <input type="text" lay-verify="required" name="softwareversion" placeholder="软件版本" autocomplete="off" class="layui-input">
          </div>
        </div>
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md4">
          <label class="layui-form-label">硬件版本：</label>
          <div class="layui-input-block">
            <input type="text" lay-verify="required" name="hardwareversion" placeholder="硬件版本" autocomplete="off" class="layui-input">
          </div>
        </div>
        <div class="layui-col-xs12 layui-col-md12 sirui-add-btn-group">
          <button class="layui-btn" lay-submit="" lay-filter="addSubmit"><i class="layui-icon">&#xe605;</i>提交</button>
        </div>
      </div>
    </form>
  </div>
  <!-- 编辑 -->
  <div id="editPage" style="display: none;">
    <form class="layui-form sirui-edit-form" lay-filter="edit-form-group">
      <div class="layui-row layui-col-space20">
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md4">
          <label class="layui-form-label">设备类型：</label>
          <div class="layui-input-block">
            <select name="leixing" lay-verify="required" palceholder="设备类型">
              <option value="">设备类型</option>
              <option value="3">OTU</option>
              <option value="1">TCUA/B</option>
              <option value="2">TCUC</option>
            </select>
          </div>
        </div>
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md4">
          <label class="layui-form-label">设备状态：</label>
          <div class="layui-input-block">
            <select name="onoffline" lay-verify="required" palceholder="设备状态">
              <option value="">设备状态</option>
              <option value="1">在线</option>
              <option value="0">离线</option>
            </select>
          </div>
        </div>
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md4">
          <label class="layui-form-label">terminalID：</label>
          <div class="layui-input-block">
            <input type="text" lay-verify="required" name="terminalid" placeholder="设备ID" autocomplete="off" class="layui-input">
          </div>
        </div>
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md4">
          <label class="layui-form-label">IMEI：</label>
          <div class="layui-input-block">
            <input type="text" lay-verify="required" name="IMEI" placeholder="IMEI" autocomplete="off" class="layui-input">
          </div>
        </div>
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md4">
          <label class="layui-form-label">barCode：</label>
          <div class="layui-input-block">
            <input type="text" lay-verify="required" name="barcode" placeholder="barCode" autocomplete="off" class="layui-input">
          </div>
        </div>
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md4">
          <label class="layui-form-label">软件名称：</label>
          <div class="layui-input-block">
            <input type="text" lay-verify="required" name="softwarename" placeholder="软件名称" autocomplete="off" class="layui-input">
          </div>
        </div>
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md4">
          <label class="layui-form-label">软件版本：</label>
          <div class="layui-input-block">
            <input type="text" lay-verify="required" name="softwareversion" placeholder="软件版本" autocomplete="off" class="layui-input">
          </div>
        </div>
        <div class="layui-col-xs12 layui-col-sm6 layui-col-md4">
          <label class="layui-form-label">硬件版本：</label>
          <div class="layui-input-block">
            <input type="text" lay-verify="required" name="hardwareversion" placeholder="硬件版本" autocomplete="off" class="layui-input">
          </div>
        </div>
        <div class="layui-col-xs12 layui-col-md12 sirui-add-btn-group">
          <button class="layui-btn" lay-submit="" lay-filter="update"><i class="layui-icon">&#xe605;</i>提交</button>
        </div>
      </div>
    </form>
  </div>
  <script src="../../../../layui/layui.js"></script>
  <script src="../../../lib/extend/jquery.min.js"></script>
  <script src="../../../lib/extend/jquery.parser.js"></script>
  <script src="../../../lib/extend/jquery.panel.js"></script>
  <script src="../../../lib/extend/jquery.linkbutton.js"></script>
  <script src="../../../lib/extend/jquery.resizable.js"></script>
  <script src="../../../lib/extend/jquery.draggable.js"></script>
  <script src="../../../lib/extend/jquery.pagination.js"></script>
  <script src="../../../lib/extend/jquery.datagrid.js"></script>
  <script src="../../../lib/extend/jquery.message.js"></script>
  <script src="../../../lib/sirui.table.js"></script>
  <script>
    layui.config({
      base: '/build/' //指定 layuiAdmin 项目路径
      , version: '1.1.2'
    }).use(['form', 'laydate', 'laypage'], function () {
      var $ = layui.$
        , element = layui.element
        , layer = layui.layer
        , laydate = layui.laydate
        , laypage = layui.laypage
        , form = layui.form;
      // 筛选参数
      var tableParams = {
        leixing: "3",
        onOffline: "1",
        terminalID: "",
        IMEI: "",
        barcode: "",
        softwarename: "",
        softwareversion: "",
        hardwareversion: "",
        page: 1,
        rows: 10
      };
      // 表格参数
      var tableConfig = {
          loadMsg: '正在加载 ，请稍候！',
          emptyMsg: '<span class="emptyTxt">对不起，暂无符合数据!</span>',
          remoteSort: false,
          fitColumns: true,
          autoSizeColumn: true,
          idField: 'ENTITYID',
          frozenColumns: [[]],
          columns: [
            [{
              field: 'a',
              title: '操作',
              align: 'center',
              formatter: function (value, rec) {
                return '<a class="opreat-link">升级</a><div class="ant-divider ant-divider-vertical"></div><a class="opreat-link">压测</a><div class="ant-divider ant-divider-vertical"></div><a class="opreat-link">图表</a><div class="ant-divider ant-divider-vertical"></div><a class="opreat-link edit-btn" data-id="' + rec.ENTITYID + '">编辑</a>'
              }
            },
              {
                field: 'CLIENTTYPE',
                title: '接入端类型',
                sortable: true,
                sorter: function (a, b) {
                  return (a > b ? 1 : -1);
                },
                formatter: function (value, rec) {
                  var msg = "";
                  if (value == 1) {
                    msg = "TCUA/B";
                  } else if (value == 2) {
                    msg = "TCUC";
                  } else if (value == 3) {
                    msg = "OTU";
                  }
                  return "<span title=\"" + msg + "\"  style='color:red'>" + msg + "</span>";
                }
              },
              {
                field: 'ENTITYID',
                title: 'entityID',
                sortable: true
              },
              {
                field: 'IMEI',
                title: 'IMEI',
                sortable: true
              },
              {
                field: 'BARCODE',
                title: 'barCode',
                sortable: true
              },
              {
                field: 'SOFTWARENAME',
                title: '软件名称',
                sortable: true
              },
              {
                field: 'SOFTWAREVERSION',
                title: '软件版本号',
                sortable: true
              },
              {
                field: 'HARDWAREVERSION',
                title: '硬件版本号',
                sortable: true
              },
              {
                field: 'BANK',
                title: '运行bank',
                sortable: true
              },
              {
                field: 'LOGINTIME',
                title: '接入时间',
                sortable: true
              },
              {
                field: 'LASTMESSAGETIME',
                title: '离线',
                sortable: true,
                formatter: function (value, rec) {
                  if (value.indexOf('在线')) {
                    return "<span class='sirui-dot dot-green'></span>在线";
                  } else {
                    return "<span class='sirui-dot dot-red'></span>" + value;
                  }
                }
              },
              {
                field: 'STARTTIME',
                title: '升级开始时间',
                sortable: true,
                formatter: function (value, rec) {
                  if (rec.CURRENT > 0) {//正在升级
                    return "<span class='c-green'>" + rec.STARTTIME + "</span>";
                  }
                }
              },
              {
                field: 'b',
                title: '升级信息',
                width: 200,
                align: 'center',
                formatter: function (value, rec) {
                  if (rec.CURRENT > 0) {//正在升级
                    return "<div style=\"width: 190px; height: 20px;\" class=\"easyui-progressbar progressbar\">\n" + "    <div class=\"progressbar-text\" style=\"width: 190px; height: 20px; line-height: 20px;\">\n" + "        " + rec.PERCENT + "%\n" + "    </div>\n" + "    <div class=\"progressbar-value\" style=\"width: " + rec.PERCENT
                      + "%; height: 20px; line-height: 20px;\">\n" + "        <div class=\"progressbar-text\" style=\"width: 190px; height: 20px; line-height: 20px;\">\n" + "            " + rec.PERCENT + "%\n" + "        </div>\n" + "    </div>\n" + "</div>"
                  } else {
                    return "<span style='color:gray'>未升级</span>";
                  }
                }
              }]],
          pagination: false,
          nowrap: true,
          onLoadSuccess: function () {
            initOpreat();
          }
        };
      // 表格初始化函数
      siruiTable.init($, tableParams, '/api/client/getList', layer, laypage, form, tableConfig);
      // 新增提交事件
      form.on('submit(addSubmit)', function(data) {
        layer.open({
          type: 1,
          title: '提交信息',
          content: JSON.stringify(data.field)
        });
        return false;
      });
      // 编辑提交事件
      form.on('submit(update)', function(data) {
        layer.open({
          type: 1,
          title: '提交信息',
          content: JSON.stringify(data.field)
        });
        return false;
      });
      // 编辑表单数据对应参数
      var editdataType = {
          leixing: {
            type: 'select',
            key: 'CLIENTTYPE'
          },
          onoffline: {
            type: 'select',
            key: 'LASTMESSAGETIME'
          },
          terminalid: {
            type: 'input',
            key: 'ENTITYID'
          },
          IMEI: {
            type: 'input',
            key: 'IMEI'
          },
          barcode: {
            type: 'input',
            key: 'BARCODE'
          },
          softwarename: {
            type: 'input',
            key: 'SOFTWARENAME'
          },
          softwareversion: {
            type: 'input',
            key: 'SOFTWAREVERSION'
          },
          hardwareversion: {
            type: 'input',
            key: 'HARDWAREVERSION'
          }
      };
      // 初始化点击事件
      function initOpreat () {
        $('.edit-btn').click(function () {
          var index = $('#sirui-table').datagrid('getRowIndex', $(this).attr('data-id'));
          var rowData = siruiTable.tableData[index];
          layer.open({
            type: 1,
            title: '编辑设备',
            area: ['1000px', 'auto'],
            content: $('#editPage').html()
          });
          // 初始化渲染编辑表单
          var formDom = $('.layui-layer-content .sirui-edit-form');
          for (var i in editdataType) {
            formDom.find(editdataType[i].type + '[name=' + i + ']').val(rowData[editdataType[i].key]);
          }
          form.render(null, 'edit-form-group');
          return false;
        })
      }
    });
  </script>
</body>
</html>